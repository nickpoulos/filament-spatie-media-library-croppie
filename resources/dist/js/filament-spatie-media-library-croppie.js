(()=>{var Mt=Object.create;var Ct=Object.defineProperty;var Ht=Object.getOwnPropertyDescriptor;var Ft=Object.getOwnPropertyNames;var Xt=Object.getPrototypeOf,Yt=Object.prototype.hasOwnProperty;var At=(b,v)=>()=>(v||b((v={exports:{}}).exports,v),v.exports);var Ot=(b,v,_,F)=>{if(v&&typeof v=="object"||typeof v=="function")for(let X of Ft(v))!Yt.call(b,X)&&X!==_&&Ct(b,X,{get:()=>v[X],enumerable:!(F=Ht(v,X))||F.enumerable});return b};var St=(b,v,_)=>(_=b!=null?Mt(Xt(b)):{},Ot(v||!b||!b.__esModule?Ct(_,"default",{value:b,enumerable:!0}):_,b));var Et=At((V,K)=>{(function(b,v){typeof define=="function"&&define.amd?define(v):typeof V=="object"&&typeof V.nodeName!="string"?K.exports=v():b.Croppie=v()})(typeof self<"u"?self:V,function(){typeof Promise!="function"&&function(t){function e(r,o){return function(){r.apply(o,arguments)}}function i(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");if(typeof r!="function")throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],s(r,e(u,this),e(a,this))}function n(r){var o=this;return this._state===null?void this._deferreds.push(r):void p(function(){var h=o._state?r.onFulfilled:r.onRejected;if(h!==null){var l;try{l=h(o._value)}catch(f){return void r.reject(f)}r.resolve(l)}else(o._state?r.resolve:r.reject)(o._value)})}function u(r){try{if(r===this)throw new TypeError("A promise cannot be resolved with itself.");if(r&&(typeof r=="object"||typeof r=="function")){var o=r.then;if(typeof o=="function")return void s(e(o,r),e(u,this),e(a,this))}this._state=!0,this._value=r,g.call(this)}catch(h){a.call(this,h)}}function a(r){this._state=!1,this._value=r,g.call(this)}function g(){for(var r=0,o=this._deferreds.length;o>r;r++)n.call(this,this._deferreds[r]);this._deferreds=null}function s(r,o,h){var l=!1;try{r(function(f){l||(l=!0,o(f))},function(f){l||(l=!0,h(f))})}catch(f){if(l)return;l=!0,h(f)}}var c=setTimeout,p=typeof setImmediate=="function"&&setImmediate||function(r){c(r,1)},m=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};i.prototype.catch=function(r){return this.then(null,r)},i.prototype.then=function(r,o){var h=this;return new i(function(l,f){n.call(h,new function(x,C,w,d){this.onFulfilled=typeof x=="function"?x:null,this.onRejected=typeof C=="function"?C:null,this.resolve=w,this.reject=d}(r,o,l,f))})},i.all=function(){var r=Array.prototype.slice.call(arguments.length===1&&m(arguments[0])?arguments[0]:arguments);return new i(function(o,h){function l(C,w){try{if(w&&(typeof w=="object"||typeof w=="function")){var d=w.then;if(typeof d=="function")return void d.call(w,function(E){l(C,E)},h)}r[C]=w,--f==0&&o(r)}catch(E){h(E)}}if(r.length===0)return o([]);for(var f=r.length,x=0;x<r.length;x++)l(x,r[x])})},i.resolve=function(r){return r&&typeof r=="object"&&r.constructor===i?r:new i(function(o){o(r)})},i.reject=function(r){return new i(function(o,h){h(r)})},i.race=function(r){return new i(function(o,h){for(var l=0,f=r.length;f>l;l++)r[l].then(o,h)})},i._setImmediateFn=function(r){p=r},typeof K<"u"&&K.exports?K.exports=i:t.Promise||(t.Promise=i)}(this),typeof window<"u"&&typeof window.CustomEvent!="function"&&function(){function t(e,i){i=i||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,i.bubbles,i.cancelable,i.detail),n}t.prototype=window.Event.prototype,window.CustomEvent=t}(),typeof HTMLCanvasElement>"u"||HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){for(var n=atob(this.toDataURL(e,i).split(",")[1]),u=n.length,a=new Uint8Array(u),g=0;g<u;g++)a[g]=n.charCodeAt(g);t(new Blob([a],{type:e||"image/png"}))}});var b,v,_,F=["Webkit","Moz","ms"],X=typeof document<"u"?document.createElement("div").style:{},Q=[1,8,3,6],J=[2,7,4,5];function T(t){if(t in X)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=F.length;i--;)if((t=F[i]+e)in X)return t}function D(t,e){t=t||{};for(var i in e)e[i]&&e[i].constructor&&e[i].constructor===Object?(t[i]=t[i]||{},D(t[i],e[i])):t[i]=e[i];return t}function tt(t){return D({},t)}function et(t){if("createEvent"in document){var e=document.createEvent("HTMLEvents");e.initEvent("change",!1,!0),t.dispatchEvent(e)}else t.fireEvent("onchange")}function R(t,e,i){if(typeof e=="string"){var n=e;(e={})[n]=i}for(var u in e)t.style[u]=e[u]}function W(t,e){t.classList?t.classList.add(e):t.className+=" "+e}function lt(t,e){for(var i in e)t.setAttribute(i,e[i])}function O(t){return parseInt(t,10)}function ht(t,e){var i=t.naturalWidth,n=t.naturalHeight,u=e||it(t);if(u&&u>=5){var a=i;i=n,n=a}return{width:i,height:n}}v=T("transform"),b=T("transformOrigin"),_=T("userSelect");var _t={translate3d:{suffix:", 0px"},translate:{suffix:""}},Z=function(t,e,i){this.x=parseFloat(t),this.y=parseFloat(e),this.scale=parseFloat(i)};Z.parse=function(t){return t.style?Z.parse(t.style[v]):t.indexOf("matrix")>-1||t.indexOf("none")>-1?Z.fromMatrix(t):Z.fromString(t)},Z.fromMatrix=function(t){var e=t.substring(7).split(",");return e.length&&t!=="none"||(e=[1,0,0,1,0,0]),new Z(O(e[4]),O(e[5]),parseFloat(e[0]))},Z.fromString=function(t){var e=t.split(") "),i=e[0].substring(Y.globals.translate.length+1).split(","),n=e.length>1?e[1].substring(6):1,u=i.length>1?i[0]:0,a=i.length>1?i[1]:0;return new Z(u,a,n)},Z.prototype.toString=function(){var t=_t[Y.globals.translate].suffix||"";return Y.globals.translate+"("+this.x+"px, "+this.y+"px"+t+") scale("+this.scale+")"};var q=function(t){if(!t||!t.style[b])return this.x=0,void(this.y=0);var e=t.style[b].split(" ");this.x=parseFloat(e[0]),this.y=parseFloat(e[1])};function it(t){return t.exifdata&&t.exifdata.Orientation?O(t.exifdata.Orientation):1}function ut(t,e,i){var n=e.width,u=e.height,a=t.getContext("2d");switch(t.width=e.width,t.height=e.height,a.save(),i){case 2:a.translate(n,0),a.scale(-1,1);break;case 3:a.translate(n,u),a.rotate(180*Math.PI/180);break;case 4:a.translate(0,u),a.scale(1,-1);break;case 5:t.width=u,t.height=n,a.rotate(90*Math.PI/180),a.scale(1,-1);break;case 6:t.width=u,t.height=n,a.rotate(90*Math.PI/180),a.translate(0,-u);break;case 7:t.width=u,t.height=n,a.rotate(-90*Math.PI/180),a.translate(-n,u),a.scale(1,-1);break;case 8:t.width=u,t.height=n,a.translate(0,n),a.rotate(-90*Math.PI/180)}a.drawImage(e,0,0,n,u),a.restore()}function Rt(){var t,e,i,n,u,a,g=this.options.viewport.type?"cr-vp-"+this.options.viewport.type:null;this.options.useCanvas=this.options.enableOrientation||nt.call(this),this.data={},this.elements={},t=this.elements.boundary=document.createElement("div"),i=this.elements.viewport=document.createElement("div"),e=this.elements.img=document.createElement("img"),n=this.elements.overlay=document.createElement("div"),this.options.useCanvas?(this.elements.canvas=document.createElement("canvas"),this.elements.preview=this.elements.canvas):this.elements.preview=e,W(t,"cr-boundary"),t.setAttribute("aria-dropeffect","none"),u=this.options.boundary.width,a=this.options.boundary.height,R(t,{width:u+(isNaN(u)?"":"px"),height:a+(isNaN(a)?"":"px")}),W(i,"cr-viewport"),g&&W(i,g),R(i,{width:this.options.viewport.width+"px",height:this.options.viewport.height+"px"}),i.setAttribute("tabindex",0),W(this.elements.preview,"cr-image"),lt(this.elements.preview,{alt:"preview","aria-grabbed":"false"}),W(n,"cr-overlay"),this.element.appendChild(t),t.appendChild(this.elements.preview),t.appendChild(i),t.appendChild(n),W(this.element,"croppie-container"),this.options.customClass&&W(this.element,this.options.customClass),function(){var s,c,p,m,r,o=this,h=!1;function l(d,E){var y=o.elements.preview.getBoundingClientRect(),L=r.y+E,B=r.x+d;o.options.enforceBoundary?(m.top>y.top+E&&m.bottom<y.bottom+E&&(r.y=L),m.left>y.left+d&&m.right<y.right+d&&(r.x=B)):(r.y=L,r.x=B)}function f(d){o.elements.preview.setAttribute("aria-grabbed",d),o.elements.boundary.setAttribute("aria-dropeffect",d?"move":"none")}function x(d){if((d.button===void 0||d.button===0)&&(d.preventDefault(),!h)){if(h=!0,s=d.pageX,c=d.pageY,d.touches){var E=d.touches[0];s=E.pageX,c=E.pageY}f(h),r=Z.parse(o.elements.preview),window.addEventListener("mousemove",C),window.addEventListener("touchmove",C),window.addEventListener("mouseup",w),window.addEventListener("touchend",w),document.body.style[_]="none",m=o.elements.viewport.getBoundingClientRect()}}function C(d){d.preventDefault();var E=d.pageX,y=d.pageY;if(d.touches){var L=d.touches[0];E=L.pageX,y=L.pageY}var B=E-s,A=y-c,M={};if(d.type==="touchmove"&&d.touches.length>1){var I=d.touches[0],z=d.touches[1],H=Math.sqrt((I.pageX-z.pageX)*(I.pageX-z.pageX)+(I.pageY-z.pageY)*(I.pageY-z.pageY));p||(p=H/o._currentZoom);var N=H/p;return j.call(o,N),void et(o.elements.zoomer)}l(B,A),M[v]=r.toString(),R(o.elements.preview,M),$.call(o),c=y,s=E}function w(){f(h=!1),window.removeEventListener("mousemove",C),window.removeEventListener("touchmove",C),window.removeEventListener("mouseup",w),window.removeEventListener("touchend",w),document.body.style[_]="",U.call(o),P.call(o),p=0}o.elements.overlay.addEventListener("mousedown",x),o.elements.viewport.addEventListener("keydown",function(d){var E=37,y=38,L=39,B=40;if(!d.shiftKey||d.keyCode!==y&&d.keyCode!==B){if(o.options.enableKeyMovement&&d.keyCode>=37&&d.keyCode<=40){d.preventDefault();var A=function(I){switch(I){case E:return[1,0];case y:return[0,1];case L:return[-1,0];case B:return[0,-1]}}(d.keyCode);r=Z.parse(o.elements.preview),document.body.style[_]="none",m=o.elements.viewport.getBoundingClientRect(),function(I){var z=I[0],H=I[1],N={};l(z,H),N[v]=r.toString(),R(o.elements.preview,N),$.call(o),document.body.style[_]="",U.call(o),P.call(o),p=0}(A)}}else{var M;M=d.keyCode===y?parseFloat(o.elements.zoomer.value)+parseFloat(o.elements.zoomer.step):parseFloat(o.elements.zoomer.value)-parseFloat(o.elements.zoomer.step),o.setZoom(M)}}),o.elements.overlay.addEventListener("touchstart",x)}.call(this),this.options.enableZoom&&function(){var s=this,c=s.elements.zoomerWrap=document.createElement("div"),p=s.elements.zoomer=document.createElement("input");function m(){(function(o){var h=this,l=o?o.transform:Z.parse(h.elements.preview),f=o?o.viewportRect:h.elements.viewport.getBoundingClientRect(),x=o?o.origin:new q(h.elements.preview);function C(){var y={};y[v]=l.toString(),y[b]=x.toString(),R(h.elements.preview,y)}if(h._currentZoom=o?o.value:h._currentZoom,l.scale=h._currentZoom,h.elements.zoomer.setAttribute("aria-valuenow",h._currentZoom),C(),h.options.enforceBoundary){var w=function(y){var L=this._currentZoom,B=y.width,A=y.height,M=this.elements.boundary.clientWidth/2,I=this.elements.boundary.clientHeight/2,z=this.elements.preview.getBoundingClientRect(),H=z.width,N=z.height,vt=B/2,gt=A/2,wt=-1*(vt/L-M),yt=-1*(gt/L-I),bt=1/L*vt,xt=1/L*gt;return{translate:{maxX:wt,minX:wt-(H*(1/L)-B*(1/L)),maxY:yt,minY:yt-(N*(1/L)-A*(1/L))},origin:{maxX:H*(1/L)-bt,minX:bt,maxY:N*(1/L)-xt,minY:xt}}}.call(h,f),d=w.translate,E=w.origin;l.x>=d.maxX&&(x.x=E.minX,l.x=d.maxX),l.x<=d.minX&&(x.x=E.maxX,l.x=d.minX),l.y>=d.maxY&&(x.y=E.minY,l.y=d.maxY),l.y<=d.minY&&(x.y=E.maxY,l.y=d.minY)}C(),Zt.call(h),P.call(h)}).call(s,{value:parseFloat(p.value),origin:new q(s.elements.preview),viewportRect:s.elements.viewport.getBoundingClientRect(),transform:Z.parse(s.elements.preview)})}function r(o){var h,l;if(s.options.mouseWheelZoom==="ctrl"&&o.ctrlKey!==!0)return 0;h=o.wheelDelta?o.wheelDelta/1200:o.deltaY?o.deltaY/1060:o.detail?o.detail/-60:0,l=s._currentZoom+h*s._currentZoom,o.preventDefault(),j.call(s,l),m.call(s)}W(c,"cr-slider-wrap"),W(p,"cr-slider"),p.type="range",p.step="0.0001",p.value="1",p.style.display=s.options.showZoomer?"":"none",p.setAttribute("aria-label","zoom"),s.element.appendChild(c),c.appendChild(p),s._currentZoom=1,s.elements.zoomer.addEventListener("input",m),s.elements.zoomer.addEventListener("change",m),s.options.mouseWheelZoom&&(s.elements.boundary.addEventListener("mousewheel",r),s.elements.boundary.addEventListener("DOMMouseScroll",r))}.call(this),this.options.enableResize&&function(){var s,c,p,m,r,o,h,l=this,f=document.createElement("div"),x=!1,C=50;W(f,"cr-resizer"),R(f,{width:this.options.viewport.width+"px",height:this.options.viewport.height+"px"}),this.options.resizeControls.height&&(W(o=document.createElement("div"),"cr-resizer-vertical"),f.appendChild(o)),this.options.resizeControls.width&&(W(h=document.createElement("div"),"cr-resizer-horisontal"),f.appendChild(h));function w(y){if((y.button===void 0||y.button===0)&&(y.preventDefault(),!x)){var L=l.elements.overlay.getBoundingClientRect();if(x=!0,c=y.pageX,p=y.pageY,s=y.currentTarget.className.indexOf("vertical")!==-1?"v":"h",m=L.width,r=L.height,y.touches){var B=y.touches[0];c=B.pageX,p=B.pageY}window.addEventListener("mousemove",d),window.addEventListener("touchmove",d),window.addEventListener("mouseup",E),window.addEventListener("touchend",E),document.body.style[_]="none"}}function d(y){var L=y.pageX,B=y.pageY;if(y.preventDefault(),y.touches){var A=y.touches[0];L=A.pageX,B=A.pageY}var M=L-c,I=B-p,z=l.options.viewport.height+I,H=l.options.viewport.width+M;s==="v"&&z>=C&&z<=r?(R(f,{height:z+"px"}),l.options.boundary.height+=I,R(l.elements.boundary,{height:l.options.boundary.height+"px"}),l.options.viewport.height+=I,R(l.elements.viewport,{height:l.options.viewport.height+"px"})):s==="h"&&H>=C&&H<=m&&(R(f,{width:H+"px"}),l.options.boundary.width+=M,R(l.elements.boundary,{width:l.options.boundary.width+"px"}),l.options.viewport.width+=M,R(l.elements.viewport,{width:l.options.viewport.width+"px"})),$.call(l),at.call(l),U.call(l),P.call(l),p=B,c=L}function E(){x=!1,window.removeEventListener("mousemove",d),window.removeEventListener("touchmove",d),window.removeEventListener("mouseup",E),window.removeEventListener("touchend",E),document.body.style[_]=""}o&&(o.addEventListener("mousedown",w),o.addEventListener("touchstart",w)),h&&(h.addEventListener("mousedown",w),h.addEventListener("touchstart",w)),this.elements.boundary.appendChild(f)}.call(this)}function nt(){return this.options.enableExif&&window.EXIF}function j(t){if(this.options.enableZoom){var e=this.elements.zoomer,i=S(t,4);e.value=Math.max(parseFloat(e.min),Math.min(parseFloat(e.max),i)).toString()}}function U(t){var e=this._currentZoom,i=this.elements.preview.getBoundingClientRect(),n=this.elements.viewport.getBoundingClientRect(),u=Z.parse(this.elements.preview.style[v]),a=new q(this.elements.preview),g=n.top-i.top+n.height/2,s=n.left-i.left+n.width/2,c={},p={};if(t){var m=a.x,r=a.y,o=u.x,h=u.y;c.y=m,c.x=r,u.y=o,u.x=h}else c.y=g/e,c.x=s/e,p.y=(c.y-a.y)*(1-e),p.x=(c.x-a.x)*(1-e),u.x-=p.x,u.y-=p.y;var l={};l[b]=c.x+"px "+c.y+"px",l[v]=u.toString(),R(this.elements.preview,l)}function $(){if(this.elements){var t=this.elements.boundary.getBoundingClientRect(),e=this.elements.preview.getBoundingClientRect();R(this.elements.overlay,{width:e.width+"px",height:e.height+"px",top:e.top-t.top+"px",left:e.left-t.left+"px"})}}q.prototype.toString=function(){return this.x+"px "+this.y+"px"};var ot,pt,ct,G,Zt=(ot=$,pt=500,function(){var t=this,e=arguments,i=ct&&!G;clearTimeout(G),G=setTimeout(function(){G=null,ct||ot.apply(t,e)},pt),i&&ot.apply(t,e)});function P(){var t,e=this.get();dt.call(this)&&(this.options.update.call(this,e),this.$&&typeof Prototype>"u"?this.$(this.element).trigger("update.croppie",e):(window.CustomEvent?t=new CustomEvent("update",{detail:e}):(t=document.createEvent("CustomEvent")).initCustomEvent("update",!0,!0,e),this.element.dispatchEvent(t)))}function dt(){return this.elements.preview.offsetHeight>0&&this.elements.preview.offsetWidth>0}function rt(){var t,e={},i=this.elements.preview,n=new Z(0,0,1),u=new q;dt.call(this)&&!this.data.bound&&(this.data.bound=!0,e[v]=n.toString(),e[b]=u.toString(),e.opacity=1,R(i,e),t=this.elements.preview.getBoundingClientRect(),this._originalImageWidth=t.width,this._originalImageHeight=t.height,this.data.orientation=nt.call(this)?it(this.elements.img):this.data.orientation,this.options.enableZoom?at.call(this,!0):this._currentZoom=1,n.scale=this._currentZoom,e[v]=n.toString(),R(i,e),this.data.points.length?function(a){if(a.length!==4)throw"Croppie - Invalid number of points supplied: "+a;var g=a[2]-a[0],s=this.elements.viewport.getBoundingClientRect(),c=this.elements.boundary.getBoundingClientRect(),p={left:s.left-c.left,top:s.top-c.top},m=s.width/g,r=a[1],o=a[0],h=-1*a[1]+p.top,l=-1*a[0]+p.left,f={};f[b]=o+"px "+r+"px",f[v]=new Z(l,h,m).toString(),R(this.elements.preview,f),j.call(this,m),this._currentZoom=m}.call(this,this.data.points):function(){var a=this.elements.preview.getBoundingClientRect(),g=this.elements.viewport.getBoundingClientRect(),s=this.elements.boundary.getBoundingClientRect(),c=g.left-s.left,p=g.top-s.top,m=c-(a.width-g.width)/2,r=p-(a.height-g.height)/2,o=new Z(m,r,this._currentZoom);R(this.elements.preview,v,o.toString())}.call(this),U.call(this),$.call(this))}function at(t){var e,i,n,u,a=Math.max(this.options.minZoom,0)||0,g=this.options.maxZoom||1.5,s=this.elements.zoomer,c=parseFloat(s.value),p=this.elements.boundary.getBoundingClientRect(),m=ht(this.elements.img,this.data.orientation),r=this.elements.viewport.getBoundingClientRect();this.options.enforceBoundary&&(n=r.width/m.width,u=r.height/m.height,a=Math.max(n,u)),a>=g&&(g=a+1),s.min=S(a,4),s.max=S(g,4),!t&&(c<s.min||c>s.max)?j.call(this,c<s.min?s.min:s.max):t&&(i=Math.max(p.width/m.width,p.height/m.height),e=this.data.boundZoom!==null?this.data.boundZoom:i,j.call(this,e)),et(s)}function st(t){var e=t.points,i=O(e[0]),n=O(e[1]),u=O(e[2])-i,a=O(e[3])-n,g=t.circle,s=document.createElement("canvas"),c=s.getContext("2d"),p=t.outputWidth||u,m=t.outputHeight||a;s.width=p,s.height=m,t.backgroundColor&&(c.fillStyle=t.backgroundColor,c.fillRect(0,0,p,m));var r=i,o=n,h=u,l=a,f=0,x=0,C=p,w=m;return i<0&&(r=0,f=Math.abs(i)/u*p),h+r>this._originalImageWidth&&(C=(h=this._originalImageWidth-r)/u*p),n<0&&(o=0,x=Math.abs(n)/a*m),l+o>this._originalImageHeight&&(w=(l=this._originalImageHeight-o)/a*m),c.drawImage(this.elements.preview,r,o,h,l,f,x,C,w),g&&(c.fillStyle="#fff",c.globalCompositeOperation="destination-in",c.beginPath(),c.arc(s.width/2,s.height/2,s.width/2,0,2*Math.PI,!0),c.closePath(),c.fill()),s}function mt(t,e){var i,n=this,u=[],a=null,g=nt.call(n);if(typeof t=="string")i=t,t={};else if(Array.isArray(t))u=t.slice();else{if(t===void 0&&n.data.url)return rt.call(n),P.call(n),null;i=t.url,u=t.points||[],a=t.zoom===void 0?null:t.zoom}return n.data.bound=!1,n.data.url=i||n.data.url,n.data.boundZoom=a,function(s,c){if(!s)throw"Source image missing";var p=new Image;return p.style.opacity="0",new Promise(function(m,r){function o(){p.style.opacity="1",setTimeout(function(){m(p)},1)}p.removeAttribute("crossOrigin"),s.match(/^https?:\/\/|^\/\//)&&p.setAttribute("crossOrigin","anonymous"),p.onload=function(){c?EXIF.getData(p,function(){o()}):o()},p.onerror=function(h){p.style.opacity=1,setTimeout(function(){r(h)},1)},p.src=s})}(i,g).then(function(s){if(function(C){this.elements.img.parentNode&&(Array.prototype.forEach.call(this.elements.img.classList,function(w){C.classList.add(w)}),this.elements.img.parentNode.replaceChild(C,this.elements.img),this.elements.preview=C),this.elements.img=C}.call(n,s),u.length)n.options.relative&&(u=[u[0]*s.naturalWidth/100,u[1]*s.naturalHeight/100,u[2]*s.naturalWidth/100,u[3]*s.naturalHeight/100]);else{var c,p,m=ht(s),r=n.elements.viewport.getBoundingClientRect(),o=r.width/r.height;m.width/m.height>o?c=(p=m.height)*o:(c=m.width,p=m.height/o);var h=(m.width-c)/2,l=(m.height-p)/2,f=h+c,x=l+p;n.data.points=[h,l,f,x]}n.data.orientation=t.orientation||1,n.data.points=u.map(function(C){return parseFloat(C)}),n.options.useCanvas&&function(C){var w=this.elements.canvas,d=this.elements.img;w.getContext("2d").clearRect(0,0,w.width,w.height),w.width=d.width,w.height=d.height,ut(w,d,this.options.enableOrientation&&C||it(d))}.call(n,n.data.orientation),rt.call(n),P.call(n),e&&e()})}function S(t,e){return parseFloat(t).toFixed(e||0)}function ft(){var t=this.elements.preview.getBoundingClientRect(),e=this.elements.viewport.getBoundingClientRect(),i=e.left-t.left,n=e.top-t.top,u=(e.width-this.elements.viewport.offsetWidth)/2,a=(e.height-this.elements.viewport.offsetHeight)/2,g=i+this.elements.viewport.offsetWidth+u,s=n+this.elements.viewport.offsetHeight+a,c=this._currentZoom;(c===1/0||isNaN(c))&&(c=1);var p=this.options.enforceBoundary?0:Number.NEGATIVE_INFINITY;return i=Math.max(p,i/c),n=Math.max(p,n/c),g=Math.max(p,g/c),s=Math.max(p,s/c),{points:[S(i),S(n),S(g),S(s)],zoom:c,orientation:this.data.orientation}}var Bt={type:"canvas",format:"png",quality:1},It=["jpeg","webp","png"];function Wt(t){var e=this,i=ft.call(e),n=D(tt(Bt),tt(t)),u=typeof t=="string"?t:n.type||"base64",a=n.size||"viewport",g=n.format,s=n.quality,c=n.backgroundColor,p=typeof n.circle=="boolean"?n.circle:e.options.viewport.type==="circle",m=e.elements.viewport.getBoundingClientRect(),r=m.width/m.height;return a==="viewport"?(i.outputWidth=m.width,i.outputHeight=m.height):typeof a=="object"&&(a.width&&a.height?(i.outputWidth=a.width,i.outputHeight=a.height):a.width?(i.outputWidth=a.width,i.outputHeight=a.width/r):a.height&&(i.outputWidth=a.height*r,i.outputHeight=a.height)),It.indexOf(g)>-1&&(i.format="image/"+g,i.quality=s),i.circle=p,i.url=e.data.url,i.backgroundColor=c,new Promise(function(o){switch(u.toLowerCase()){case"rawcanvas":o(st.call(e,i));break;case"canvas":case"base64":o(function(h){return st.call(this,h).toDataURL(h.format,h.quality)}.call(e,i));break;case"blob":(function(h){var l=this;return new Promise(function(f){st.call(l,h).toBlob(function(x){f(x)},h.format,h.quality)})}).call(e,i).then(o);break;default:o(function(h){var l=h.points,f=document.createElement("div"),x=document.createElement("img"),C=l[2]-l[0],w=l[3]-l[1];return W(f,"croppie-result"),f.appendChild(x),R(x,{left:-1*l[0]+"px",top:-1*l[1]+"px"}),x.src=h.url,R(f,{width:C+"px",height:w+"px"}),f}.call(e,i))}})}function zt(t){if(!this.options.useCanvas||!this.options.enableOrientation)throw"Croppie: Cannot rotate without enableOrientation && EXIF.js included";var e,i,n,u,a,g=this.elements.canvas;if(this.data.orientation=(e=this.data.orientation,i=t,n=Q.indexOf(e)>-1?Q:J,u=n.indexOf(e),a=i/90%n.length,n[(n.length+u+a%n.length)%n.length]),ut(g,this.elements.img,this.data.orientation),U.call(this,!0),at.call(this),Math.abs(t)/90%2==1){var s=this._originalImageHeight,c=this._originalImageWidth;this._originalImageWidth=s,this._originalImageHeight=c}}if(typeof window<"u"&&window.jQuery){var k=window.jQuery;k.fn.croppie=function(t){if(typeof t=="string"){var e=Array.prototype.slice.call(arguments,1),i=k(this).data("croppie");return t==="get"?i.get():t==="result"?i.result.apply(i,e):t==="bind"?i.bind.apply(i,e):this.each(function(){var n=k(this).data("croppie");if(n){var u=n[t];if(!k.isFunction(u))throw"Croppie "+t+" method not found";u.apply(n,e),t==="destroy"&&k(this).removeData("croppie")}})}return this.each(function(){var n=new Y(this,t);n.$=k,k(this).data("croppie",n)})}}function Y(t,e){if(t.className.indexOf("croppie-container")>-1)throw new Error("Croppie: Can't initialize croppie more than once");if(this.element=t,this.options=D(tt(Y.defaults),e),this.element.tagName.toLowerCase()==="img"){var i=this.element;W(i,"cr-original-image"),lt(i,{"aria-hidden":"true",alt:""});var n=document.createElement("div");this.element.parentNode.appendChild(n),n.appendChild(i),this.element=n,this.options.url=this.options.url||i.src}if(Rt.call(this),this.options.url){var u={url:this.options.url,points:this.options.points};delete this.options.url,delete this.options.points,mt.call(this,u)}}return Y.defaults={viewport:{width:100,height:100,type:"square"},boundary:{},orientationControls:{enabled:!0,leftClass:"",rightClass:""},resizeControls:{width:!0,height:!0},customClass:"",showZoomer:!0,enableZoom:!0,enableResize:!1,mouseWheelZoom:!0,enableExif:!1,enforceBoundary:!0,enableOrientation:!1,enableKeyMovement:!0,update:function(){}},Y.globals={translate:"translate3d"},D(Y.prototype,{bind:function(t,e){return mt.call(this,t,e)},get:function(){var t=ft.call(this),e=t.points;return this.options.relative&&(e[0]/=this.elements.img.naturalWidth/100,e[1]/=this.elements.img.naturalHeight/100,e[2]/=this.elements.img.naturalWidth/100,e[3]/=this.elements.img.naturalHeight/100),t},result:function(t){return Wt.call(this,t)},refresh:function(){return function(){rt.call(this)}.call(this)},setZoom:function(t){j.call(this,t),et(this.elements.zoomer)},rotate:function(t){zt.call(this,t)},destroy:function(){return function(){var t,e;this.element.removeChild(this.elements.boundary),t=this.element,e="croppie-container",t.classList?t.classList.remove(e):t.className=t.className.replace(e,""),this.options.enableZoom&&this.element.removeChild(this.elements.zoomerWrap),delete this.elements}.call(this)}}),Y})});var Lt=St(Et());document.addEventListener("alpine:init",()=>{Alpine.data("imageCropper",b=>({showCroppie:!1,hasImage:b.imageUrl.length>0,filename:"",filetype:"",originalSrc:b.imageUrl,viewportWidth:b.viewportWidth,viewportHeight:b.viewportHeight,boundaryWidth:b.boundaryWidth,boundaryHeight:b.boundaryHeight,shape:b.shape,statePath:b.statePath,showZoomer:b.showZoomer,croppie:{},init(){this.$nextTick(()=>{this.initCroppie()}),this.$watch("files",v=>{this.showCroppie=!1,this.updatePreview()})},async updatePreview(){let v,_=this.files;_==null||_[0]===void 0||(this.filename=_[0].name,this.filetype=_[0].type,v=new FileReader,v.onload=F=>{this.originalSrc=F.target.result,this.bindCroppie(F.target.result)},await v.readAsDataURL(_[0]))},initCroppie(){this.croppie=new Lt.default(this.$refs.croppie,{viewport:{width:this.viewportWidth,height:this.viewportHeight,type:this.shape},boundary:{width:this.boundaryWidth,height:this.boundaryHeight},showZoomer:this.showZoomer,enableResize:!1,mouseWheelZoom:"ctrl",enforceBoundary:!0,enableOrientation:!0,enableExif:!0})},rotateLeft(){this.croppie.rotate(90)},rotateRight(){this.croppie.rotate(-90)},saveCroppie(){this.croppie.result({type:"blob",size:"original",format:this.filetype,quality:1}).then(v=>{this.showCroppie=!1,this.hasImage=!0;let _=document.getElementById(this.statePath).getElementsByTagName("input")[0],F=new Event("change"),X=this.filename,Q=this.filetype,J=new File([v],X,{type:Q,lastModified:new Date().getTime()},"utf-8"),T=new DataTransfer;T.items.add(J),_.files=T.files,this.$dispatch("close-modal",{id:"croppie-modal-"+this.statePath,files:null}),_.dispatchEvent(F)})},bindCroppie(v){setTimeout(()=>{this.croppie.bind({url:v,orientation:1}),setTimeout(()=>{this.showCroppie=!0},200)},200)}}))});})();
